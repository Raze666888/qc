# 管理员模块API文档

## 模块概述

管理员模块提供了用户管理和问卷审核两大核心功能，确保平台的正常运行和内容合规。

## API接口列表

### 1. 统计数据

#### 获取仪表盘统计数据
- **接口**: `GET /admin/dashboard`
- **描述**: 获取管理后台首页统计数据
- **权限**: 管理员
- **响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "totalUsers": 1500,
    "todayUsers": 25,
    "totalQuestionnaires": 500,
    "pendingAudit": 12
  }
}
```

### 2. 用户管理

#### 查询用户列表（分页）
- **接口**: `GET /admin/users`
- **描述**: 查询系统注册用户，支持关键词搜索和状态筛选
- **权限**: 管理员
- **参数**:
  | 参数名 | 类型 | 必填 | 说明 |
  |--------|------|------|------|
  | pageNum | Integer | 否 | 页码，默认1 |
  | pageSize | Integer | 否 | 每页大小，默认20 |
  | keyword | String | 否 | 搜索关键词（用户名/手机号/邮箱） |
  | status | Integer | 否 | 用户状态（0-正常，1-已禁用） |
- **响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 100,
    "records": [
      {
        "id": 1,
        "username": "admin",
        "nickname": "系统管理员",
        "phone": "13800138000",
        "email": "admin@example.com",
        "role": 1,
        "points": 0,
        "createTime": "2024-01-01 10:00:00"
      }
    ]
  }
}
```

#### 更新用户状态
- **接口**: `PUT /admin/user/status`
- **描述**: 启用或禁用用户账号
- **权限**: 管理员
- **请求体**:
```json
{
  "userId": 10,
  "status": 1
}
```
- **参数说明**:
  - userId: 用户ID
  - status: 状态（0-正常，1-已禁用）
- **响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功"
}
```

### 3. 问卷审核

#### 查询待审核问卷列表
- **接口**: `GET /admin/audits`
- **描述**: 查询需要审核的问卷列表
- **权限**: 管理员
- **参数**:
  | 参数名 | 类型 | 必填 | 说明 |
  |--------|------|------|------|
  | pageNum | Integer | 否 | 页码，默认1 |
  | pageSize | Integer | 否 | 每页大小，默认20 |
  | auditStatus | Integer | 否 | 审核状态（0-待审核，1-已通过，2-已驳回） |
- **响应示例**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 50,
    "records": [
      {
        "id": 100,
        "userId": 5,
        "title": "用户满意度调查",
        "description": "关于产品质量的问卷调查",
        "status": 1,
        "auditStatus": 0,
        "createTime": "2024-01-15 10:30:00"
      }
    ]
  }
}
```

#### 审核问卷
- **接口**: `POST /admin/audit`
- **描述**: 审核问卷（通过或驳回）
- **权限**: 管理员
- **请求体**:
```json
{
  "id": 100,
  "auditStatus": 1,
  "reason": "内容合规，同意发布"
}
```
- **参数说明**:
  - id: 问卷ID
  - auditStatus: 审核结果（1-通过，2-驳回）
  - reason: 审核意见（驳回时必填）
- **响应示例**:
```json
{
  "code": 200,
  "msg": "审核完成"
}
```

## 审核流程说明

### 1. 问卷发布审核流程

```
创建者发布问卷
    ↓
问卷状态：已发布，审核状态：待审核
    ↓
管理员审核
    ↓
├─ 通过 → 审核状态：已通过，问卷保持发布状态
└─ 驳回 → 审核状态：已驳回，问卷状态：已暂停
```

### 2. 审核规则

- **待审核**: 问卷刚发布，未经过审核
- **已通过**: 问卷内容符合规范，正常展示
- **已驳回**: 问卷内容违规，自动暂停，需创建者修改后重新提交

### 3. 审核不通过处理

1. 管理员点击"驳回"，填写驳回原因
2. 系统自动将问卷状态改为"已暂停"
3. 创建者收到通知，修改问卷内容
4. 创建者重新提交审核
5. 管理员再次审核

## 用户管理规范

### 1. 用户状态

| 状态 | 说明 | 可操作 |
|------|------|--------|
| 正常 | 用户可正常使用平台所有功能 | 可禁用 |
| 已禁用 | 用户无法登录和使用平台 | 可启用 |

### 2. 禁用规则

- 管理员账号不能被禁用
- 禁用用户后，该用户立即失效
- 启用用户后，用户可正常登录

### 3. 批量操作

支持批量禁用/启用用户（前端实现），后端逐个处理

## 权限控制

### 1. 权限验证

所有管理员接口都需要验证用户角色：
```java
Integer role = jwtUtil.getRoleFromToken(token);
if (role == null || role != 1) {
    throw new BusinessException(403, "无权限访问");
}
```

### 2. 权限级别

- **role = 0**: 普通用户
- **role = 1**: 管理员

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 操作成功 |
| 400 | 参数错误 |
| 403 | 无权限访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 前端页面路由

| 页面 | 路由 | 说明 |
|------|------|------|
| 管理员仪表盘 | /admin | 首页，显示统计数据 |
| 用户管理 | /admin/user-manage | 用户列表、禁用/启用 |
| 问卷审核 | /admin/survey-audit | 审核列表、通过/驳回 |

## 使用示例

### 前端调用示例

```javascript
// 获取统计数据
const res = await axios.get('/admin/dashboard')
console.log(res.data.totalUsers)

// 查询用户列表
const users = await axios.get('/admin/users', {
  params: {
    pageNum: 1,
    pageSize: 20,
    keyword: '张三'
  }
})

// 禁用用户
await axios.put('/admin/user/status', {
  userId: 10,
  status: 1
})

// 审核通过
await axios.post('/admin/audit', {
  id: 100,
  auditStatus: 1,
  reason: '内容合规'
})

// 审核驳回
await axios.post('/admin/audit', {
  id: 101,
  auditStatus: 2,
  reason: '包含违规内容'
})
```

## 数据库字段说明

### 用户表 (sys_user)

- `deleted`: 逻辑删除标记（0-正常，1-已禁用）
- `role`: 角色标记（0-普通用户，1-管理员）

### 问卷表 (questionnaire)

- `audit_status`: 审核状态（0-待审核，1-已通过，2-已驳回）
- `status`: 问卷状态（0-草稿，1-已发布，2-已暂停，3-已删除）

## 注意事项

1. **权限验证**: 所有管理接口必须验证管理员权限
2. **操作日志**: 建议记录管理员操作日志（待实现）
3. **通知机制**: 审核结果应通知创建者（待实现）
4. **数据安全**: 禁用用户前确认，防止误操作
